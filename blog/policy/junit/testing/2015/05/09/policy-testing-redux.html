<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="msvalidate.01" content="C3BF2C67B92C75F2DEAA096973652038" />
  <link rel="shortcut icon" href="http://www.apiman.io/latest/resources/images/favicon.ico">
  <title>A great way to test your custom apiman policy! | apiman Open Source API Management</title>
  <meta name="description" content="If you have tried creating your own custom apiman policy, you may have had a little bit ofdifficulty creating useful junit tests for it.  Many policies requi...">

  <!-- CSS -->
  <link href="http://www.apiman.io/latest/resources/bootstrap-3.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="http://www.apiman.io/latest/resources/patternfly-1.0.5/css/patternfly.min.css" rel="stylesheet">
  <link href="http://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet">
  <link href="http://www.apiman.io/latest/resources/css/apiman-web.css?v=1.2.7.Final" rel="stylesheet">
  <link href="http://www.apiman.io/latest/resources/css/apiman-web.responsive.css?v=1.2.7.Final" rel="stylesheet">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/blog/css/highlight.css" rel="stylesheet">
  <link href="/blog/css/main.css" rel="stylesheet">
  <link href="/blog/css/coderay-asciidoctor.css" rel="stylesheet">


  <!-- Scripts -->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  
  <script src="http://www.apiman.io/latest/resources/jquery-1.11.1/js/jquery.min.js"></script>
  <script src="http://www.apiman.io/latest/resources/bootstrap-3.3.0/js/bootstrap.min.js"></script>
  <script id="dsq-count-scr" src="//apiman.disqus.com/count.js" async></script>

  <!-- Canonical URL --><link rel="canonical" href="http://apiman.io/blog/policy/junit/testing/2015/05/09/policy-testing.html" /><link rel="alternate" type="application/rss+xml" title="Apiman Blog | Open Source API Management" href="http://apiman.io/blog/feed.xml" />


  <!-- Google Analytics -->
  <script>
    $(document).ready(function() {
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-56678850-1', 'auto');
      ga('send', 'pageview');
    });
  </script>
  <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>
</head>
<body class="blog">
    <div id="rhbar">
      <a class="jbdevlogo" href="http://www.jboss.org/projects/about" rel="nofollow" target="_blank"></a>
      <a class="rhlogo" href="http://www.redhat.com/" rel="nofollow" target="_blank"></a>
    </div><nav id="top-nav" class="navbar navbar-inverse" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.apiman.io/latest/index.html">apiman</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li class="top-menu-item menu-item"><a href="http://www.apiman.io/latest/index.html">Overview</a></li>
        <li class="top-menu-item menu-item"><a href="http://www.apiman.io/latest/download.html">Download</a></li>
        <li class="top-menu-item menu-item"><a href="http://www.apiman.io/latest/roadmap.html">Roadmap</a></li>
        <li class="top-menu-item menu-item active"><a href="http://www.apiman.io/blog/">Blog</a></li>
        <li class="top-menu-item menu-item dropdown">
            <a href="" class="dropdown-toggle" data-toggle="dropdown">Get Involved<b class="caret"></b></a>
            <ul class="dropdown-menu">
                <li class="menu-item">
                    <a href="https://issues.jboss.org/browse/APIMAN">Report a Bug</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/chat.html">Chat on IRC</a>
                </li>
                <li class="menu-item">
                    <a href="https://twitter.com/apiman_io" rel="nofollow" target="_blank">Twitter Feed</a>
                </li>
                <li class="menu-item">
                    <a href="https://lists.jboss.org/mailman/listinfo/apiman-user" rel="nofollow" target="_blank">Mailing List</a>
                </li>
                <li class="divider"></li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/contributors.html">Contributors List</a>
                </li>
            </ul>
        </li>
        <li class="top-menu-item menu-item dropdown">
            <a href="" class="dropdown-toggle" data-toggle="dropdown">Learn More<b class="caret"></b></a>
            <ul class="dropdown-menu">
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/tutorials.html">Tutorials &amp; Walkthroughs</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/crash-course.html">Crash Course!</a>
                </li>
                <li class="divider"></li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/installation-guide.html">Installation Guide</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/user-guide.html">User Guide</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/developer-guide.html">Developer Guide</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/production-guide.html">Production Guide</a>
                </li>
                <li class="divider"></li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/api-manager-restdocs.html">API Manager REST Endpoints</a>
                </li>
            </ul>
        </li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>
<div class="container" id="blog">
      <div class="blog-content">
        <div class="post">
  <header class="post-header" style="margin-top: 25px">
    <h1 style="color: #666; font-weight: bold" class="post-title section-header">A great way to test your custom apiman policy!</h1>
    <span style="color: #243446; font-size: 13px"><i class="fa fa-calendar"></i> May 9, 2015</span>
    <span style="color: #243446; margin-left: 15px; font-size: 13px"><i class="fa fa-user"></i> <a href="https://www.github.com/ericwittmann">Eric Wittmann</a></span>
    <span style="color: #243446; margin-left: 15px; font-size: 13px"><i class="fa fa-tags"></i> policy, junit, and testing</span>
  </header><!-- Old Post -->
    <p class="bg-warning"
       style="margin-top:15px; padding: 10px;">
        Note: A newer revision of this blogpost for <b>apiman 1.2.x</b> can be found <a href="http://apiman.io/blog/policy/junit/testing/2015/05/09/policy-testing.html">here</a>. This version was written for <b>apiman 1.1.x</b>.
    </p><article class="post-content"
           style="margin-top: 20px; font-size: 14px; line-height: 20px">
    <p>If you have tried creating your own custom apiman policy, you may have had a little bit of
difficulty creating useful junit tests for it.  Many policies require various apiman
runtime components to be available.  It can be super annoying trying to use something like
mockito to create mock versions of everything your policy needs.  Even for simple policies
you really just want a quick and effective way to test the implementation within a
reasonably “real world” harness.</p>

<p>Well you’ve probably guessed by now that I’m about to show you how it’s done!  (OK fine,
how it <em>will</em> be done in the next release of apiman - 1.1.3.Final)</p>

<!--more-->

<p>In this post I’ll explain (and show!) you how to write a unit test for your apiman
policy, using the new Policy Tester junit framework we’ve created.</p>

<h2 id="first-you-need-a-custom-policy">First you need a custom policy!</h2>

<p>If you haven’t created a custom apiman policy yet, have a look at the
<a href="http://www.apiman.io/latest/developer-guide.html#_plugins">Developer Guide</a> to
learn how.</p>

<p>So for example, let’s say you’ve created your own simple custom policy class and it
looks like this:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySimplePolicy</span> <span class="kd">implements</span> <span class="n">IPolicy</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">parseConfiguration</span><span class="o">(</span><span class="n">String</span> <span class="n">jsonConfiguration</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ConfigurationParseException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">jsonConfiguration</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">ApiRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">IPolicyContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">Object</span> <span class="n">config</span><span class="o">,</span>
            <span class="n">IPolicyChain</span><span class="o">&lt;</span><span class="n">ApiRequest</span><span class="o">&gt;</span> <span class="n">chain</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"X-MTP-Header"</span><span class="o">,</span> <span class="s">"Hello World"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"X-Fail-Test"</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">IPolicyFailureFactoryComponent</span> <span class="n">failureFactory</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getComponent</span><span class="o">(</span><span class="n">IPolicyFailureFactoryComponent</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">chain</span><span class="o">.</span><span class="na">doFailure</span><span class="o">(</span><span class="n">failureFactory</span><span class="o">.</span><span class="na">createFailure</span><span class="o">(</span><span class="n">PolicyFailureType</span><span class="o">.</span><span class="na">Other</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="s">"Failure"</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">chain</span><span class="o">.</span><span class="na">doApply</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">ApiResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">IPolicyContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">Object</span> <span class="n">config</span><span class="o">,</span>
            <span class="n">IPolicyChain</span><span class="o">&lt;</span><span class="n">ApiResponse</span><span class="o">&gt;</span> <span class="n">chain</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"X-MTP-Response-Header"</span><span class="o">,</span> <span class="s">"Goodbye World"</span><span class="o">);</span>
        <span class="n">chain</span><span class="o">.</span><span class="na">doApply</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="ok-ive-got-a-policy-how-do-i-test-it">OK I’ve got a policy, how do I test it?</h2>

<p>Now that you’ve got your policy, you need a quick and effective way to test it.  I also
think it’s important for your test to run quickly and for you to be able to easily set
breakpoints to debug the code.  We explored using <a href="http://arquillian.org/" target="_blank" rel="nofollow">Arquillian</a>
to configure and publish an API with the custom policy to a running WildFly server.
It actually works remarkably well, but the overhead of firing up a WildFly server just
to test a single policy seemed excessive.  That work will likely lead into a separate
testing effort focused on testing larger integration scenarios.</p>

<p>OK enough - let’s get to the test!  The first thing you need is to pull the Policy
Tester dependency into your project’s pom.xml:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>io.apiman<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>apiman-test-policies<span class="nt">&lt;/artifactId&gt;</span>
   <span class="nt">&lt;version&gt;</span>1.1.2-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
   <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<p>Great - now just create a new junit test and make sure it extends the <code class="highlighter-rouge">ApimanPolicyTest</code>
base test class.  In that junit test you’ll need to sprinkle in a few annotations
provided by the apiman Policy Testing framework.  At a minimum you will need to
include the <code class="highlighter-rouge">@TestingPolicy</code> and <code class="highlighter-rouge">@Configuration</code> annotations.  Both of these annotations
can be specified at either the <em>Class</em> or <em>Method</em> level. The former tells the testing
framework which policy is being tested.  The latter describes the policy configuration
that should be used for the test.</p>

<p>Just look at the example, already:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@TestingPolicy</span><span class="o">(</span><span class="n">MySimplePolicy</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTestPolicyTest1</span> <span class="kd">extends</span> <span class="n">ApimanPolicyTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="nd">@Configuration</span><span class="o">(</span><span class="s">"{}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="c1">// Send a test HTTP request to the API (resulting in executing the policy).</span>
        <span class="n">PolicyTestResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">send</span><span class="o">(</span><span class="n">PolicyTestRequest</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">PolicyTestRequestType</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/some/resource"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"X-Test-Name"</span><span class="o">,</span> <span class="s">"testGet"</span><span class="o">));</span>

        <span class="c1">// Now do some assertions on the result!</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">code</span><span class="o">());</span>
        <span class="n">EchoResponse</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">entity</span><span class="o">(</span><span class="n">EchoResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">"GET"</span><span class="o">,</span> <span class="n">entity</span><span class="o">.</span><span class="na">getMethod</span><span class="o">());</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">"/some/resource"</span><span class="o">,</span> <span class="n">entity</span><span class="o">.</span><span class="na">getResource</span><span class="o">());</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">"testGet"</span><span class="o">,</span> <span class="n">entity</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"X-Test-Name"</span><span class="o">));</span>
        <span class="c1">// Assert the request header that was added by the policy</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">,</span> <span class="n">entity</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"X-MTP-Header"</span><span class="o">));</span>
        <span class="c1">// Assert the response header was added by the policy</span>
        <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">"Goodbye World"</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"X-MTP-Response-Header"</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<h2 id="so-whats-going-on-here">So what’s going on here?</h2>

<p>Let me tell you!  For each test method in your junit test, we’ll actually spin up a fully
functional apiman API Gateway.  We’ll also publish a test API that’s configured with
your custom policy (and using the policy configuration you specified in the <code class="highlighter-rouge">@Configuration</code>
annotation).  After that, it’s a simple matter of sending one or more simulated HTTP
requests to the gateway.  You do that by sending a <code class="highlighter-rouge">PolicyTestRequest</code> to the <code class="highlighter-rouge">send</code> method.
Easy peasy!</p>

<p>Note that it’s pretty easy to create a <code class="highlighter-rouge">PolicyTestRequest</code> - there’s a nice little fluent
builder you can use to create it.  The builder allows you to set the HTTP verb, the resource
path, and any HTTP headers.</p>

<h2 id="what-about-the-back-end-api">What about the back-end API?</h2>

<p>Yeah that’s a good point.  Assuming your policy doesn’t produce a failure, the API Gateway
we’re using for the test needs to “invoke” a back-end API and return the result.  We
simulate this rather than actually going out and making a REST request.  By default, we
create a simple Echo back-end API which bundles up all the information in the REST
request (including anything your policy may have added to the request) and builds a JSON
response that includes all that information.  This is handy because it allows you to
verify that, for example, any HTTP headers your policy added to the request actually
made it through to the back-end API.</p>

<p>Now are you ready for an advanced topic?  If not I understand, you can just hit the Back
button on your browser!</p>

<p>Still here?  Great!  Another thing you can do is actually provide your own simulated
back-end API.  This is necessary sometimes when your policy does something
specific with, for example, the API response payload.  You may actually need your
test to respond in a certain way.  To accomplish this all you need to do is use the
<code class="highlighter-rouge">@BackEndApi</code> annotation, providing a <em>Class</em> that implements the
<code class="highlighter-rouge">IPolicyTestBackEndApi</code> interface.  You do that, and we’ll use your simulated
back end API for the test instead of the echo API!  :)</p>

<p>What would that look like?  Something like this:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@TestingPolicy</span><span class="o">(</span><span class="n">MySimplePolicy</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTestPolicyTest1</span> <span class="kd">extends</span> <span class="n">ApimanPolicyTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="nd">@Configuration</span><span class="o">(</span><span class="s">"{}"</span><span class="o">)</span>
    <span class="nd">@BackEndApi</span><span class="o">(</span><span class="n">MyCustomBackEndApiImpl</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
        <span class="c1">// Send a test HTTP request to the API (resulting in executing the policy).</span>
        <span class="n">PolicyTestResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">send</span><span class="o">(</span><span class="n">PolicyTestRequest</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">PolicyTestRequestType</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/some/resource"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"X-Test-Name"</span><span class="o">,</span> <span class="s">"testGet"</span><span class="o">));</span>

        <span class="c1">// Now do some assertions on the result!</span>
        <span class="n">MyCustomBackEndApiResponseBean</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">entity</span><span class="o">(</span><span class="n">MyCustomBackEndApiResponseBean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// Do some more assertions here using the entity from above!</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>And then perhaps your custom back end implementation class might look like this:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCustomBackEndApiImpl</span> <span class="kd">implements</span> <span class="n">IPolicyTestBackEndApi</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">PolicyTestBackEndApiResponse</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">ApiRequest</span> <span class="n">request</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">requestBody</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Create a valid API response for this request, and then configure it.</span>
        <span class="n">ApiResponse</span> <span class="n">apiResponse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApiResponse</span><span class="o">();</span>
        <span class="n">apiResponse</span><span class="o">.</span><span class="na">setCode</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span>
        <span class="n">apiResponse</span><span class="o">.</span><span class="na">setMessage</span><span class="o">(</span><span class="s">"OK"</span><span class="o">);</span>
        <span class="n">apiResponse</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"Date"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
        <span class="n">apiResponse</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"Server"</span><span class="o">,</span> <span class="s">"apiman.policy-test"</span><span class="o">);</span>
        <span class="n">apiResponse</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/plain"</span><span class="o">);</span>
        <span class="c1">// Let's respond with a classic "Hello World" for the response body</span>
        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="s">"Hello World"</span><span class="o">;</span>
        <span class="n">PolicyTestBackEndApiResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PolicyTestBackEndApiResponse</span><span class="o">(</span><span class="n">apiResponse</span><span class="o">,</span> <span class="n">body</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Alright - if you made it this far thanks for reading!!</p>

<p>/post</p>

  </article><div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = '';
        this.page.identifier = '/policy/junit/testing/2015/05/09/policy-testing-redux';
    };

    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//apiman.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>

      </div>
      <div class="blog-footer"><footer role="contentinfo">
    <div id="inner-footer" class="clearfix row">
        <div id="widget-footer" class="clearfix">
            <hr>
            <div class="widget col-sm-6 col-md-6 widget_text">
                <div class="textwidget">
                    <p>
                        Copyright &copy; 2017 Red Hat, Inc. All rights reserved.<br>
                        apiman code is open source and released under <a href="http://www.apache.org/licenses/LICENSE-2.0.html" rel="nofollow" target="_blank">Apache License, v2.0</a>.<br>
                        <a href="/latest/disclosure.html">Open Source Disclosure</a>
                    </p>
                </div>
            </div>
            <div class="widget col-sm-6 col-md-6 widget_text" style="text-align: right">
                <a href="http://www.redhat.com" rel="nofollow" target="_blank"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png" alt="Red Hat"></a>
            </div>
        </div>
        <nav class="clearfix"></nav>
    </div>

    <!-- Adobe Analytics -->
    <script type="text/javascript">
      if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
      }
    </script>
</footer>
</div>
    </div>
  </body>
</html>
