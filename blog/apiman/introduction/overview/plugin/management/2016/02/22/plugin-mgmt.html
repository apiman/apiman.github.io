<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="msvalidate.01" content="C3BF2C67B92C75F2DEAA096973652038" />
  <link rel="shortcut icon" href="http://www.apiman.io/latest/resources/images/favicon.ico">
  <title>Apiman 1.2 - Improvements to Plugin Management | apiman Open Source API Management</title>
  <meta name="description" content="Apiman is not only preconfigured with a rich set of policies that you can use, right out of the box, but, from its earliest releases, apiman has also include...">

  <link href="http://www.apiman.io/latest/resources/bootstrap-3.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="http://www.apiman.io/latest/resources/patternfly-1.0.5/css/patternfly.min.css" rel="stylesheet">
  <link href="http://static.jboss.org/css/rhbar.css" media="screen" rel="stylesheet">
  <link href="http://www.apiman.io/latest/resources/css/apiman-web.css?v=1.2.2.Final" rel="stylesheet">
  <link href="http://www.apiman.io/latest/resources/css/apiman-web.responsive.css?v=1.2.2.Final" rel="stylesheet">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/blog/css/highlight.css" rel="stylesheet">
  <link href="/blog/css/main.css" rel="stylesheet">
  <link href="/blog/css/coderay-asciidoctor.css" rel="stylesheet">
  
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  
  <script src="http://www.apiman.io/latest/resources/jquery-1.11.1/js/jquery.min.js"></script>
  <script src="http://www.apiman.io/latest/resources/bootstrap-3.3.0/js/bootstrap.min.js"></script>
  <script>
      $(document).ready(function() {
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-56678850-1', 'auto');
              ga('send', 'pageview');
      });
  </script>

    
    <link rel="canonical" href="http://apiman.io/blog/apiman/introduction/overview/plugin/management/2016/02/22/plugin-mgmt.html">
    

  <link rel="alternate" type="application/rss+xml" title="apiman Blog | Open Source API Management" href="http://apiman.io/blog/feed.xml" />
</head>

  <body class="blog">
    <div id="rhbar">
      <a class="jbdevlogo" href="http://www.jboss.org/projects/about" rel="nofollow" target="_blank"></a>
      <a class="rhlogo" href="http://www.redhat.com/" rel="nofollow" target="_blank"></a>
    </div>
    <nav id="top-nav" class="navbar navbar-inverse" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://www.apiman.io/latest/index.html">apiman</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li class="top-menu-item menu-item"><a href="http://www.apiman.io/latest/index.html">Overview</a></li>
        <li class="top-menu-item menu-item"><a href="http://www.apiman.io/latest/download.html">Download</a></li>
        <li class="top-menu-item menu-item"><a href="http://www.apiman.io/latest/roadmap.html">Roadmap</a></li>
        <li class="top-menu-item menu-item active"><a href="http://www.apiman.io/blog/">Blog</a></li>
        <li class="top-menu-item menu-item dropdown">
            <a href="" class="dropdown-toggle" data-toggle="dropdown">Get Involved<b class="caret"></b></a>
            <ul class="dropdown-menu">
                <li class="menu-item">
                    <a href="https://issues.jboss.org/browse/APIMAN">Report a Bug</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/chat.html">Chat on IRC</a>
                </li>
                <li class="menu-item">
                    <a href="https://twitter.com/apiman_io" rel="nofollow" target="_blank">Twitter Feed</a>
                </li>
                <li class="menu-item">
                    <a href="https://lists.jboss.org/mailman/listinfo/apiman-user" rel="nofollow" target="_blank">Mailing List</a>
                </li>
                <li class="divider"></li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/contributors.html">Contributors List</a>
                </li>
            </ul>
        </li>
        <li class="top-menu-item menu-item dropdown">
            <a href="" class="dropdown-toggle" data-toggle="dropdown">Learn More<b class="caret"></b></a>
            <ul class="dropdown-menu">
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/tutorials.html">Tutorials &amp; Walkthroughs</a>
                </li>
                <li class="divider"></li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/installation-guide.html">Installation Guide</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/user-guide.html">User Guide</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/developer-guide.html">Developer Guide</a>
                </li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/production-guide.html">Production Guide</a>
                </li>
                <li class="divider"></li>
                <li class="menu-item">
                    <a href="http://www.apiman.io/latest/api-manager-restdocs.html">API Manager REST Endpoints</a>
                </li>
            </ul>
        </li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>


    <div class="container" id="blog">
      <div class="blog-content">
        

<div class="post">
  <header class="post-header" style="margin-top: 25px">
    <h1 style="color: #666; font-weight: bold" class="post-title section-header">Apiman 1.2 - Improvements to Plugin Management</h1>
    <span style="color: #243446; font-size: 13px"><i class="fa fa-calendar"></i> Feb 22, 2016</span>
    <span style="color: #243446; margin-left: 15px; font-size: 13px"><i class="fa fa-user"></i> <a href="https://github.com/ldimaggi">Len DiMaggio</a></span>
    <span style="color: #243446; margin-left: 15px; font-size: 13px"><i class="fa fa-tags"></i> apiman, introduction, overview, plugin, and management</span>
  </header>


  

  

  <article class="post-content"
           style="margin-top: 20px; font-size: 14px; line-height: 20px">
    <p>Apiman is not only preconfigured with a rich set of policies that you can use, right out of the box, but, from its earliest releases, apiman has also included a mechanism that you can use to define your own custom policies through plugins. This article describes the improvements introduced in apiman release 1.2.x that enable you to better manage your custom policy plugins.</p>

<!--more-->

<h3 id="policies-the-most-important-part-of-api-management">Policies, the Most Important Part of API Management</h3>

<p>In API Management, policies are where the action is. It’s through the application of policies that an API Management system such as apiman performs API governance. All the subsystems in apiman, from the Management API UI to the API Gateway, exist for one ultimate goal; to ensure that API governance is achieved by the application of policies to API requests. In apiman, a policy is a rule, or set of rules that controls responses to API requests. There are multiple types of apiman policies. Some policies allow or block access to APIs based on the IP address of the client application, while others allow or restrict access to specific resources provided by an API, while still others enable you to control or “throttle” the rate at which requests made to an API.</p>

<h3 id="apiman-plugin-management-improvements---extending-flexibility">Apiman Plugin Management Improvements - Extending Flexibility</h3>

<p>Apiman release 1.2.x adds these new features that enable you to better manage your custom policy plugins:</p>

<ul>
  <li>Uninstalling Policies</li>
  <li>Upgrading Policies</li>
  <li>Automatically Reloading SNAPSHOT Version Policies</li>
</ul>

<p>The best way to understand how these features work is to see them in action.</p>

<h3 id="uninstalling-a-policy-plugin">Uninstalling a Policy Plugin</h3>

<p>Before we can uninstall a policy plugin, we have to install it.</p>

<p>Apiman is preconfigured with a core set of policy types that can handle many common situations:</p>

<ul>
  <li>Authorization - Access to API resources is controlled by user roles</li>
  <li>BASIC Authentication - A username/password is required to access an API</li>
  <li>Caching - Cache responses from a backend API</li>
  <li>Ignored Resources - Paths to API resources that will not be accessible</li>
  <li>IP Blacklist - Clients with specific IP address(es) will be blocked from accessing an API</li>
  <li>IP Whitelist - Clients with specific IP address(es) will not be blocked from accessing an API (all IP addresses not listed will be blocked)</li>
  <li>Limiting - Access to an API is limited by the number of requests in a defined time period (generally used to create a fine-grained limit)</li>
  <li>Quota - Access to an API is limited by the number of requests in a defined time period (generally used to create a coarse-grained limit)</li>
  <li>Transfer Quota - Similar to a Quota policy, but based on the number of bytes transferred, not the number of requests</li>
</ul>

<p>These core policy types cannot be uninstalled.</p>

<p>Apiman is also includes second set of policy types which can be optionally installed as plugins:</p>

<ul>
  <li>CORS - This plugin implements CORS (Cross-origin resource sharing): A method of controlling access to resources outside of an originating domain.</li>
  <li>HTTP Security - Provides a policy which allows security-related HTTP headers to be set, which can help mitigate a range of common security vulnerabilities.</li>
  <li>JSONP - A plugin that contributes a policy that turns a standard RESTful endpoint into a JSONP compatible endpoint.</li>
  <li>Keycloak OAuth - This plugin offers an OAuth2 policy which leverages the Keycloak authentication platform as the identity and access provider.</li>
  <li>Log Headers - Offers a simple policy that allows request headers to be added or stripped from the HTTP request (outgoing) or HTTP response (incoming).</li>
  <li>XML&lt;-&gt;JSON Transformation - This plugin provides a very simple policy which can transform the request and/or response payload between XML and JSON.</li>
</ul>

<p>The optional plugins are accessed in this administrative page in the apiman Management UI:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_1.png" alt="Image: Optional Plugins" /></p>

<p>To install a policy plugin, click on “Install” - for example, to install the Log Headers Policy:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_2.png" alt="Image: Log Policy Plugin" /></p>

<p>And, it’s installed!</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_3.png" alt="Image: Log Policy Plugin Installed" /></p>

<p>OK, we installed the policy plugin. Now, let’s uninstall it!</p>

<p>Uninstalling a policy plugin is as simple as installing it. All you do is select the plugin from the “Manage Plugins” page in the Administrative UI:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_4.png" alt="Image: Log Policy Plugin Uninstalled " /></p>

<p>There are a couple of caveats to keep in mind when you uninstall a policy plugin:</p>

<ul>
  <li>First, uninstalling the plugin removes it from the apiman Management UI, but it still remains in use for all APIs in which it was previously configured.</li>
  <li>Second, if you want to completely remove the plugin from all APIs in which it was previously configured, you must manually click on each API, Plan, and Client App that uses the policy and remove it. Apiman does not include a single “kill” button to automatically remove all references to a policy.</li>
</ul>

<h3 id="upgrading-policy-plugins">Upgrading Policy Plugins</h3>

<p>In addition to enabling you to create and install your own custom policies, apiman also provides a mechanism to upgrade to new versions of those policies. This is an especially useful feature as, over time, a policy may be upgraded to include bug fixes or new features.</p>

<p>The best way to illustrate how to upgrade a policy plugin is to follow the process step-by-step.</p>

<p>For this illustration, we’ll use one of the policy plugins provided in the official apiman plugins git repository ( <a href="https://github.com/apiman/apiman-plugins" target="_blank" rel="nofollow">https://github.com/apiman/apiman-plugins</a> ) as our custom plugin. Many of the plugins provided in this repository are also available set of “available plugins” packaged with apiman. We’ll use one of the plugins (“test-policy” - it’s a very simple policy that adds a header to the inbound http request) that is not already installed into apiman for this example.</p>

<p>(Note that in order to follow this example, you will have to have maven and git installed.)</p>

<p>To download the policy plugins, execute these commands:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>git clone https://github.com/apiman/apiman-plugins.git
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>cd apiman-plugins
</pre></div>
</div>
</div>

<p>Before we build the plugins, we have to make one small change. The plugins as downloaded are assigned version numbers that include a -“SNAPSHOT” suffix. We will want to remove that suffix for this example. (Sneak peek: We will restore the suffix later in this article as apiman includes a new feature where “SNAPSHOT” version plugins are automatically reloaded.)</p>

<p>To make these changes, edit these files, and change the version from “1.2.2-SNAPSHOT” to “1.2.2”:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>./pom.xml
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>test-policy/pom.xml
</pre></div>
</div>
</div>

<p>Then, to build the plugins, and install them into your local maven repo (at runtime, the apiman API Gateway installs plugins from the local maven “.m2” repo directory), execute this command:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>mvn install
</pre></div>
</div>
</div>

<p>OK, our policy plugin is built, let’s add it into the management UI.</p>

<p>As an administrative user, navigate to the “Manage Plugins” page in the Management UI and select the “Available Plugins” tab, and then, click on the “Add Custom Plugin” button. The following dialog is displayed:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_5.png" alt="Image: Add Custom Plugin " /></p>

<p>Fill in the details for the “test-policy” plugin. (You can find all this information in the plugin’s “pom.xml” file.) apiman will use this information to locate the policy plugin in your local maven repo:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_6.png" alt="Image: Add Custom Plugin Details " /></p>

<p>And, after you click on the “Add Plugin” button, the policy plugin is installed:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_7.png" alt="Image: Custom Plugin Added " /></p>

<p>Notice that there are (2) buttons in the “Actions” column of the “Installed Plugins”  table. The button labeled with an “X” enables you to remove the plugin. The button labeled with an up-arrow enables you to upgrade the policy plugin.</p>

<p>In order for apiman to recognize that a plugin policy has been updated, the plugin version number must change. To change the version number of the test-policy plugin, edit these files, and change the version from “1.2.2” to “1.2.3”:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>./pom.xml
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>test-policy/pom.xml
</pre></div>
</div>
</div>

<p>Then, to rebuild the plugins, and install them into your local maven repo, execute this command:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>mvn clean install
</pre></div>
</div>
</div>

<p>After rebuilding the plugins, return to the apiman Management UI, and click on the plugin policy’s upgrade button. Enter the new plugin version number in the dialog that is displayed:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_8.png" alt="Image: Set the Updated Version Number " /></p>

<p>And, after you perform the upgrade by clicking on the “OK” button, the plugin is upgraded:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_9.png" alt="Image: View the Updated Version Number " /></p>

<p>There are a few important things to keep in mind while upgrading policy plugins:</p>

<ul>
  <li>The upgraded version of a policy plugin replaces the previous version.</li>
  <li>Plans, APIs, or Client Apps that had previously been configured with the old version of the plugin policy will continue to use that older version. They will not be automatically updated to use the upgraded version of the policy plugin.</li>
  <li>New Plans, APIs, or Client Apps that are created after the policy plugin was upgraded will use the new/upgraded version.</li>
  <li>If you want to upgrade existing Plans, APIs, or Client Apps to use an upgraded policy plugin, then you will have to manually remove the old policy plugin version and then add the new policy plugin version. The apiman project documentation recommends against doing this unless there is a bug fix or new feature added in a policy plugin upgrade.</li>
</ul>

<h3 id="automatically-reloading-snapshot-version-policies">Automatically Reloading SNAPSHOT Version Policies</h3>

<p>The final new feature added to Plugin Management in apiman 1.2.x is the automatic reloading of SNAPSHOT version policy plugins.</p>

<p>When you are developing a custom policy plugin, you may have to uninstall and reinstall the plugin many times while it is being debugged. This can quickly become a time-consuming manual task. Apiman 1.2.x now makes it possible for you avoid this manual installing/re-installing.</p>

<p>As we’ve just seen, the apiman API Gateway installs policy plugins from your local maven repo. To be more efficient, the API Gateway caches plugins the first time that they are used. If, however, a plugin’s version ends with a “-SNAPSHOT” suffix, then the API Gateway will reload it every time the plugin is used.</p>

<p>So, by including a “-SNAPSHOT” suffix in your custom policy plugin’s version, you can iterate through changes to the policy plugin  without having to manually uninstall and then install each new version of the plugin.</p>

<p>Let’s take a look at this in action.</p>

<p>Since we want to take advantage of the automatic reloading, we must restore the “-SNAPSHOT” suffix to the test-policy custom policy plugin. To make these changes, edit these files, and change the version from “1.2.3” to “1.2.2-SNAPSHOT”:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>./pom.xml
<span class="line-numbers"><a href="#n2" name="n2">2</a></span>test-policy/pom.xml
</pre></div>
</div>
</div>

<p>Then, to build the plugins, and install them into your local maven repo, execute this command:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>mvn clean install
</pre></div>
</div>
</div>

<p>And then add the custom policy plugin in the Management UI:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_10.png" alt="Image: Add SNAPSHOT Plugin " /></p>

<p>And, here’s the installed plugin:</p>

<p><img src="/blog/images/2016-02-22/plugin_mgmt_11.png" alt="Image: View SNAPSHOT Plugin " /></p>

<p>Before we can configure the custom policy plugin, we need an API. For this example, we’ll use our old friend, “apiman-echo.” You can download this API from this git repository: <a href="https://github.com/apiman/apiman-quickstarts" target="_blank" rel="nofollow">https://github.com/apiman/apiman-quickstarts</a></p>

<p>The steps to build, deploy, and configure this API are available in the first article in this series: <a href="http://www.apiman.io/blog/introduction/overview/2015/01/09/impatient-new-user-redux.html">The Impatient New User Guide to apiman</a></p>

<p>We’ll use the postman web client to access the API. The first time that we access the API, we’ll see this response (note the text highlighted in green):</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>{
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span> <span style="color:#606"><span style="color:#404">"</span><span>method</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">GET</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span> <span style="color:#606"><span style="color:#404">"</span><span>resource</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/apiman-echo</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span> <span style="color:#606"><span style="color:#404">"</span><span>uri</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/apiman-echo</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span> <span style="color:#606"><span style="color:#404">"</span><span>headers</span><span style="color:#404">"</span></span> : {
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Accept</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">*/*</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Cache-Control</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">no-cache</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>User-Agent</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Connection</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">keep-alive</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>   <span style="color:#606"><span style="color:#404">"</span><span>Test-Policy</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">true</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Postman-Token</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">8808bb68-1c1c-ef97-449d-ab60f620b0e5</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Host</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">localhost:8080</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Accept-Language</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">en-US,en;q=0.8</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Accept-Encoding</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">gzip, deflate, sdch</span><span style="color:#710">"</span></span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span> },
<span class="line-numbers"><a href="#n16" name="n16">16</a></span> <span style="color:#606"><span style="color:#404">"</span><span>bodyLength</span><span style="color:#404">"</span></span> : <span style="color:#088">null</span>,
<span class="line-numbers"><a href="#n17" name="n17">17</a></span> <span style="color:#606"><span style="color:#404">"</span><span>bodySha1</span><span style="color:#404">"</span></span> : <span style="color:#088">null</span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>}
</pre></div>
</div>
</div>

<p>OK, now, let’s change the policy plugin. In this file: src/main/java/io/apiman/plugins/test_policy/TestPolicy.java</p>

<p>Change this line from this: request.getHeaders().put(“Test-Policy”, “true”);</p>

<p>To this: request.getHeaders().put(“Test-Policy”, “quite true”);</p>

<p>And then, rebuild the plugin with this command:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"><a href="#n1" name="n1">1</a></span>mvn clean install -DskipTests
</pre></div>
</div>
</div>

<p>(The “skipTests” directive is a bit of laziness. There is a test included in the plugin that will fail because of the change that we just made. You can either run this command as is, or you can edit the test in the plugin to also look for a string of “quite true.”)</p>

<p>Now, when we access the API again, we’ll see the change reflected - without our having to manually upgrade or uninstall/install the policy plugin:</p>

<div class="highlighter-coderay"><div class="CodeRay">
  <div class="code"><pre><span class="line-numbers"> <a href="#n1" name="n1">1</a></span>{
<span class="line-numbers"> <a href="#n2" name="n2">2</a></span> <span style="color:#606"><span style="color:#404">"</span><span>method</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">GET</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n3" name="n3">3</a></span> <span style="color:#606"><span style="color:#404">"</span><span>resource</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/apiman-echo</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n4" name="n4">4</a></span> <span style="color:#606"><span style="color:#404">"</span><span>uri</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">/apiman-echo</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n5" name="n5">5</a></span> <span style="color:#606"><span style="color:#404">"</span><span>headers</span><span style="color:#404">"</span></span> : {
<span class="line-numbers"> <a href="#n6" name="n6">6</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Accept</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">*/*</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n7" name="n7">7</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Cache-Control</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">no-cache</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n8" name="n8">8</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>User-Agent</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36</span><span style="color:#710">"</span></span>,
<span class="line-numbers"> <a href="#n9" name="n9">9</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Connection</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">keep-alive</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><strong><a href="#n10" name="n10">10</a></strong></span>   <span style="color:#606"><span style="color:#404">"</span><span>Test-Policy</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">quite true</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><a href="#n11" name="n11">11</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Postman-Token</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">bb900e07-249c-66e4-980a-2c9a70002c45</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><a href="#n12" name="n12">12</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Host</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">localhost:8080</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><a href="#n13" name="n13">13</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Accept-Language</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">en-US,en;q=0.8</span><span style="color:#710">"</span></span>,
<span class="line-numbers"><a href="#n14" name="n14">14</a></span>   <span style="color:#606"><span style="color:#404">"</span><span>Accept-Encoding</span><span style="color:#404">"</span></span> : <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">"</span><span style="color:#D20">gzip, deflate, sdch</span><span style="color:#710">"</span></span>
<span class="line-numbers"><a href="#n15" name="n15">15</a></span> },
<span class="line-numbers"><a href="#n16" name="n16">16</a></span> <span style="color:#606"><span style="color:#404">"</span><span>bodyLength</span><span style="color:#404">"</span></span> : <span style="color:#088">null</span>,
<span class="line-numbers"><a href="#n17" name="n17">17</a></span> <span style="color:#606"><span style="color:#404">"</span><span>bodySha1</span><span style="color:#404">"</span></span> : <span style="color:#088">null</span>
<span class="line-numbers"><a href="#n18" name="n18">18</a></span>}
</pre></div>
</div>
</div>

<h3 id="in-conclusion">In Conclusion</h3>

<p>From its first releases, apiman has provided users with flexibility, including support for adding custom policies through plugins. In the latest release, apiman has expanded on that flexibility by enabling users to uninstall policy plugins, upgrade policy plugins, and automatically reload policy plugins.</p>

<h3 id="references">References</h3>

<ul>
  <li>
    <p>You can see a more detailed walk-through on how a custom policy plugin is created in this apiman blog post: <a href="http://www.apiman.io/blog/plugins/policies/development/maven/2015/03/06/custom-policies-redux.html">http://www.apiman.io/blog/plugins/policies/development/maven/2015/03/06/custom-policies-redux.html</a></p>
  </li>
  <li>
    <p>The “postman” client is available here: <a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en" target="_blank" rel="nofollow">https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en</a></p>
  </li>
</ul>

<p>/post</p>

  </article>

</div>

      </div>
      <div class="blog-footer">
        <footer role="contentinfo">
    <div id="inner-footer" class="clearfix row">
        <div id="widget-footer" class="clearfix">
            <hr>
            <div class="widget col-sm-6 col-md-6 widget_text">
                <div class="textwidget">
                    <p>
                        Copyright &copy; 2016 Red Hat, Inc. All rights reserved.<br>
                        apiman code is open source and released under <a href="http://www.apache.org/licenses/LICENSE-2.0.html" rel="nofollow" target="_blank">Apache License, v2.0</a>.<br>
                        <a href="/latest/disclosure.html">Open Source Disclosure</a>
                    </p>
                </div>
            </div>
            <div class="widget col-sm-6 col-md-6 widget_text" style="text-align: right">
                <a href="http://www.redhat.com" rel="nofollow" target="_blank"><img src="http://static.jboss.org/theme/images/common/redhat_logo.png" alt="Red Hat"></a>
            </div>
        </div>
        <nav class="clearfix"></nav>
    </div>
</footer>

      </div>
    </div>
  </body>
</html>
