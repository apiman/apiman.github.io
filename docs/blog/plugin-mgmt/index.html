<!doctype html><html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="theme-color" content="rgb(61, 94, 129)">
<title>Apiman - Apiman 1.2 - Improvements to Plugin Management</title>
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/assets/manifest/icon-192x192.png">
<link rel="icon" type="image/png" href="/assets/manifest/icon-192x192.png">
<link rel="prefetch" href="/assets/styles/OpenSans.css" as="style">
<link rel="stylesheet" href="/assets/styles/OpenSans.css">
<link rel="stylesheet" href="/assets/styles/main.css?1754568806">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
<script src="https://code.jquery.com/jquery-3.6.1.slim.min.js" crossorigin="anonymous" async></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous" async></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous" defer></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js" defer></script>
<title>Apiman 1.2 - Improvements to Plugin Management | Apiman</title>
<meta name="generator" content="Jekyll v4.4.1">
<meta property="og:title" content="Apiman 1.2 - Improvements to Plugin Management">
<meta name="author" content="Len DiMaggio">
<meta property="og:locale" content="en_US">
<meta name="description" content="Apiman is not only preconfigured with a rich set of policies that you can use, right out of the box, but, from its earliest releases, apiman has also included a mechanism that you can use to define your own custom policies through plugins. This article describes the improvements introduced in apiman release 1.2.x that enable you to better manage your custom policy plugins.">
<meta property="og:description" content="Apiman is not only preconfigured with a rich set of policies that you can use, right out of the box, but, from its earliest releases, apiman has also included a mechanism that you can use to define your own custom policies through plugins. This article describes the improvements introduced in apiman release 1.2.x that enable you to better manage your custom policy plugins.">
<link rel="canonical" href="https://www.apiman.io/blog/plugin-mgmt/">
<meta property="og:url" content="https://www.apiman.io/blog/plugin-mgmt/">
<meta property="og:site_name" content="Apiman">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-02-22T12:30:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Apiman 1.2 - Improvements to Plugin Management">
<meta name="twitter:site" content="@apiman_io">
<meta name="twitter:creator" content="@apiman_io">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Len DiMaggio","url":"https://github.com/ldimaggi"},"dateModified":"2016-02-22T12:30:00+00:00","datePublished":"2016-02-22T12:30:00+00:00","description":"Apiman is not only preconfigured with a rich set of policies that you can use, right out of the box, but, from its earliest releases, apiman has also included a mechanism that you can use to define your own custom policies through plugins. This article describes the improvements introduced in apiman release 1.2.x that enable you to better manage your custom policy plugins.","headline":"Apiman 1.2 - Improvements to Plugin Management","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.apiman.io/blog/plugin-mgmt/"},"url":"https://www.apiman.io/blog/plugin-mgmt/"}</script>
<meta name="article:tag" content="apiman">
<meta name="og:article:tag" content="apiman">
<meta name="article:tag" content="introduction">
<meta name="og:article:tag" content="introduction">
<meta name="article:tag" content="overview">
<meta name="og:article:tag" content="overview">
<meta name="article:tag" content="plugin">
<meta name="og:article:tag" content="plugin">
<meta name="article:tag" content="management">
<meta name="og:article:tag" content="management">
<meta name="google-site-verification" content="_ILllw-J_4eyz0StWadyFz0021teANtSNJsDeN9waPE">
</head>
<body onload=hljs.highlightAll()>
<div class="content">
<div class="container-fluid" id="apiman-navbar">
<nav class="mx-auto d-flex flex-wrap py-3 navbar navbar-dark navbar-expand-lg justify-content-between mw-1200">
<a href="/" title="Return To Home" class="d-flex align-items-center text-decoration-none">
<svg id="apiman-logo-mono" height="40" viewBox="0 0 3007 607" xmlns:xlink="http://www.w3.org/1999/xlink" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><title>Apiman Logo</title><path d="M950.593 49.784C912.432 18.245 856.743 2.48 783.472 2.48H590.53V606.5H718.611V391.678H773.556c74.918.0 132.695-17.211 173.312-51.657C987.505 305.6 1007.82 255.881 1007.82 190.874 1007.82 128.352 988.74 81.324 950.593 49.784zM849.172 263.381c-19.561 15.574-49.032 23.331-88.408 23.331H718.611V107.421h58.254C811.833 107.421 837.519 114.58 853.911 128.894c16.393 14.329 24.586 36.5 24.586 66.523C878.497 225.169 868.722 247.828 849.172 263.381z" style="fill:#fff;fill-rule:nonzero"/><rect x="1067.88" y="2.48" width="128.086" height="604.02" style="fill:#fff;fill-rule:nonzero"/><path d="M2891.35 288.379C2891.35 320.877 2894.64 454.873 2894.64 454.873L2632.3 2.485H2470.76V606.5H2585.2V322.263C2585.2 287.827 2581.08 149.569 2581.08 149.569L2843.82 606.5h162.79V2.48H2891.35V288.379z" style="fill:#fff;fill-rule:nonzero"/><path d="M2197.23.0l-272.6 522.385V2.48H1750.3L1598.67 464.367H1596.19L1453.25 2.48H1278.89V606.5h114.46V325.557C1393.35 293.339 1389.2 132.62 1389.2 132.62L1534.63 606.5h117.34l155.75-473.047S1806.28 256.287 1805.86 273.91C1805.45 291.552 1805.24 307.116 1805.24 320.611V606.5h220.51l71.04-143.78h175.83L2272.57 606.5h122.71V0H2197.23zM2272.63 355.314H2148.44s110.6-230.938 122.7-263.999L2272.62 91.114v264.2H2272.63z" style="fill:#fff;fill-rule:nonzero"/><g><path d="M232.295 605.909H231.954C235.79 599.873 243 588.017 243 588.017S239.187 511.071 251.92 486.886C258.215 474.935 278.992 465.334 286.143 453.883c21.335-34.166 55.394-100.06 55.849-135.831C342.271 296.622 315.216 236.601 315.216 236.601l-30.12 53.562S293.18 299.686 292.899 303.55C291.517 322.433 275.65 366.584 275.65 366.584L290.239 372.824 296.233 391.7S290.319 392.348 289.529 393.93C288.346 396.285 292.848 403.94 292.848 403.94s-24.53 12.222-31.302 7.839C253.397 406.503 255.467 388.988 252.699 370.732 248.078 340.298 242.052 305.47 242.194 304.662 242.94 300.475 250.919 290.124 250.919 290.124V277.89S258.861 162.927 272.622 156.259C280.207 152.583 323.184 153.171 367.242 159.971 367.242 159.971 370.882 153.309 370.067 151.138 368.683 147.455 356.599 143.007 356.599 143.007S350.341 109.116 365.717 95.974c14.541-12.433 47.494-1.095 48.087 9.67C415.299 132.837 415.77 164.829 425.529 173.442c16.408 14.483 36.629 17.223 44.936 27.432 18.545 22.797 17.006 75.628 15.843 116.481C486.199 321.226 494.259 326.459 494.838 330.288 496.722 342.747 495.393 369.033 491.632 390.896 488.61 408.472 484.019 423.188 478.267 425.563 471.651 428.295 450.493 418.587 450.493 418.587S454.521 411.782 453.47 409.681C452.771 408.279 447.523 407.696 447.523 407.696L451.621 391.815 462.415 385.867l-8.178-38.835c-11.407 55.937-20.948 79.243-23.681 106.342C430.101 457.913 431.879 467.104 431.255 471.638c-3.721 27.091-26.722 110.905-26.724 110.902L453.427 605.908H452.482L453.429 606.022H530.714v-604H315.762L0 606.022H231.956L232.295 605.909zm37.855.0L270.453 606.022h97.835L368.772 605.908H368.286C369.049 597.795 381.047 581.375 381.047 581.375S371.94 503.682 373.669 495.93C375.749 486.607 390.409 472.115 392.798 462.875 396.744 447.618 391.63 399.847 391.63 399.847s-47.929 55.921-65.256 73.299C323.367 476.164 316.245 481.132 313.67 484.525c-18.087 23.74-51.163 99.044-51.163 99.044L270.451 605.909H270.15z" style="fill:#fff;fill-rule:nonzero"/><path d="M389.514 302.191S397.258 254.837 397.748 238.79C398.112 226.915 393.05 191.501 393.05 191.501L384.498 173.894S391.428 173.076 396.75 173.894C401.69 174.654 406.131 177.412 406.131 177.412L396.071 190.997s13.886 36.203 16.649 48.792C416.356 256.348 421.715 307.227 421.715 307.227S416.894 314.501 415.065 316.758C412.451 319.981 403.705 328.862 403.705 328.862S399.126 317.753 397.232 314.23C395.539 311.08 389.514 302.191 389.514 302.191z" style="fill:#fff;fill-rule:nonzero"/></g></svg>
</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse flex-grow-0" id="navbarToggler">
<ul class="nav nav-pills flex-column flex-lg-row">
<li class="nav-item">
<a href="/download.html" class="nav-link" aria-current="page">Download</a>
<li class="nav-item">
<a href="/features.html" class="nav-link" aria-current="page">Features</a>
<li class="nav-item">
<a href="/blog" class="nav-link" aria-current="page">Blog</a>
<li class="nav-item">
<a href="https://www.apiman.io/apiman-docs/" class="nav-link" aria-current="page">Documentation</a>
<li class="nav-item">
<a href="/community.html" class="nav-link" aria-current="page">Community</a>
<li class="nav-item">
<a href="/support.html" class="nav-link" aria-current="page">Support</a>
</ul>
</div>
</nav>
</div>
<div class="container-fluid">
<div class="mw-1200 mx-auto my-5 row">
<aside class="col-lg-2 d-lg-block d-none">
<div class="list-group justify-content-center sticky-top ps-0" id="generic-sidebar">
<a href="https://www.github.com/apiman/apiman/issues" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-bug"></i> Found an Issue?
</a>
<a href="/changelog.html" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-book"></i> Changelog
</a>
<a href="https://www.github.com/apiman/apiman" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-github"></i> Source Code
</a>
<a href="https://www.github.com/apiman/apiman-plugins" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-plugin"></i> Apiman Plugins
</a>
<a href="https://www.github.com/apiman/apiman-docker" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-docker"></i> Docker Images
</a>
<a href="https://github.com/apiman/apiman/releases" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-clock"></i> Older Releases
</a>
<a href="https://github.com/orgs/apiman/discussions" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-chat-left-text"></i> Discussions
</a>
<a href="https://www.twitter.com/apiman_io" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-twitter"></i> Twitter
</a>
<a href="https://www.apiman.io/apiman-docs/migration-guide/latest/migrations.html" class="list-group-item list-group-item-action" target="_blank" rel="noopener">
<i class="bi bi-paper-plane"></i> Migration Guide
</a>
</div>
</aside>
<div class="col-lg-10 col-sm-12">
<main class="mw-900">
<article itemscope itemtype="https://schema.org/BlogPosting">
<h1 itemprop="headline">Apiman 1.2 - Improvements to Plugin Management</h1>
<div class="text-secondary"><span itemprop="datePublished">22 February 2016</span> · <span itemprop="keywords">apiman, introduction, overview, plugin, management</span></div>
<div class="d-flex py-2 mb-4 mt-3 border-top border-bottom mb-2" id="author-holder">
<img class="rounded-3 align-self-center" width="80rem" src="https://avatars.githubusercontent.com/u/642621" alt="Avatar for Len DiMaggio">
<div class="d-flex flex-column ms-2 justify-content-evenly">
<div class="text-secondary d-none d-sm-block">Quality engineering legend and prolific technical writer.</div>
<div class="fs-5">
<a class="link-dark" rel="author" href="https://github.com/ldimaggi" target="_blank" itemprop="author">Len DiMaggio</a>
<span class="apiman-title-secondary" style="white-space:nowrap">
<span class="d-none d-sm-inline">/</span>
Red Hat
<span class="d-none d-sm-inline">/</span>
</span>
<span style="white-space:nowrap">
<span><a class="link-secondary ps-1" href="https://github.com/ldimaggi" target="_blank"><i class="bi bi-globe"></i></a></span>
<span><a class="link-secondary ps-1" href="https://www.github.com/ldimaggi" target="_blank"><i class="bi bi-github"></i></a></span>
<span><a class="link-secondary ps-1" href="mailto:ldimaggi@redhat.com" target="_blank"><i class="bi bi-envelope-at-fill"></i></a></span>
</span>
</div>
</div>
</div>
<div class="blog-content" itemprop="articleBody">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apiman is not only preconfigured with a rich set of policies that you can use, right out of the box, but, from its earliest releases, apiman has also included a mechanism that you can use to define your own custom policies through plugins. This article describes the improvements introduced in apiman release 1.2.x that enable you to better manage your custom policy plugins.
</div>
</div>
</div>
<div class="sect1">
<h2 id="policies-the-most-important-part-of-api-management"><a class="anchor" href="#policies-the-most-important-part-of-api-management"></a>Policies, the Most Important Part of API Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In API Management, policies are where the action is. It&#8217;s through the application of policies that an API Management system such as apiman performs API governance. All the subsystems in apiman, from the Management API UI to the API Gateway, exist for one ultimate goal; to ensure that API governance is achieved by the application of policies to API requests. In apiman, a policy is a rule, or set of rules that controls responses to API requests. There are multiple types of apiman policies. Some policies allow or block access to APIs based on the IP address of the client application, while others allow or restrict access to specific resources provided by an API, while still others enable you to control or "throttle" the rate at which requests made to an API.
</div>
</div>
</div>
<div class="sect1">
<h2 id="apiman-plugin-management-improvements-extending-flexibility"><a class="anchor" href="#apiman-plugin-management-improvements-extending-flexibility"></a>Apiman Plugin Management Improvements - Extending Flexibility</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apiman release 1.2.x adds these new features that enable you to better manage your custom policy plugins:
</div>
<div class="ulist">
<ul>
<li>
<p>Uninstalling Policies
<li>
<p>Upgrading Policies
<li>
<p>Automatically Reloading SNAPSHOT Version Policies
</ul>
</div>
<div class="paragraph">
<p>The best way to understand how these features work is to see them in action.
</div>
</div>
</div>
<div class="sect1">
<h2 id="uninstalling-a-policy-plugin"><a class="anchor" href="#uninstalling-a-policy-plugin"></a>Uninstalling a Policy Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we can uninstall a policy plugin, we have to install it.
</div>
<div class="paragraph">
<p>Apiman is preconfigured with a core set of policy types that can handle many common situations:
</div>
<div class="ulist">
<ul>
<li>
<p>Authorization - Access to API resources is controlled by user roles
<li>
<p>BASIC Authentication - A username/password is required to access an API
<li>
<p>Caching - Cache responses from a backend API
<li>
<p>Ignored Resources - Paths to API resources that will not be accessible
<li>
<p>IP Blacklist - Clients with specific IP address(es) will be blocked from accessing an API
<li>
<p>IP Whitelist - Clients with specific IP address(es) will not be blocked from accessing an API (all IP addresses not listed will be blocked)
<li>
<p>Limiting - Access to an API is limited by the number of requests in a defined time period (generally used to create a fine-grained limit)
<li>
<p>Quota - Access to an API is limited by the number of requests in a defined time period (generally used to create a coarse-grained limit)
<li>
<p>Transfer Quota - Similar to a Quota policy, but based on the number of bytes transferred, not the number of requests
</ul>
</div>
<div class="paragraph">
<p>These core policy types cannot be uninstalled.
</div>
<div class="paragraph">
<p>Apiman is also includes second set of policy types which can be optionally installed as plugins:
</div>
<div class="ulist">
<ul>
<li>
<p>CORS - This plugin implements CORS (Cross-origin resource sharing): A method of controlling access to resources outside of an originating domain.
<li>
<p>HTTP Security - Provides a policy which allows security-related HTTP headers to be set, which can help mitigate a range of common security vulnerabilities.
<li>
<p>JSONP - A plugin that contributes a policy that turns a standard RESTful endpoint into a JSONP compatible endpoint.
<li>
<p>Keycloak OAuth - This plugin offers an OAuth2 policy which leverages the Keycloak authentication platform as the identity and access provider.
<li>
<p>Simple Headers - Offers a simple policy that allows request headers to be added or stripped from the HTTP request (outgoing) or HTTP response (incoming).
<li>
<p>XML\&lt;&#8594;JSON Transformation - This plugin provides a very simple policy which can transform the request and/or response payload between XML and JSON.
<li>
<p>Log Headers - A policy that logs request and/or response headers to the server console.
</ul>
</div>
<div class="paragraph">
<p>The optional plugins are accessed in this administrative page in the apiman Management UI:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_1.png" alt="Image: Optional Plugins">
</div>
</div>
<div class="paragraph">
<p>To install a policy plugin, click on "Install" - for example, to install the Log Headers Policy:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_2.png" alt="Image: Log Policy Plugin">
</div>
</div>
<div class="paragraph">
<p>And, it&#8217;s installed!
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_3.png" alt="Image: Log Policy Plugin Installed">
</div>
</div>
<div class="paragraph">
<p>OK, we installed the policy plugin. Now, let&#8217;s uninstall it!
</div>
<div class="paragraph">
<p>Uninstalling a policy plugin is as simple as installing it. All you do is select the plugin from the "Manage Plugins" page in the Administrative UI:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_4.png" alt="Image: Log Policy Plugin Uninstalled">
</div>
</div>
<div class="paragraph">
<p>There are a couple of caveats to keep in mind when you uninstall a policy plugin:
</div>
<div class="ulist">
<ul>
<li>
<p>First, uninstalling the plugin removes it from the apiman Management UI, but it still remains in use for all APIs in which it was previously configured.
<li>
<p>Second, if you want to completely remove the plugin from all APIs in which it was previously configured, you must manually click on each API, Plan, and Client App that uses the policy and remove it. Apiman does not include a single "kill" button to automatically remove all references to a policy.
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading-policy-plugins"><a class="anchor" href="#upgrading-policy-plugins"></a>Upgrading Policy Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to enabling you to create and install your own custom policies, apiman also provides a mechanism to upgrade to new versions of those policies. This is an especially useful feature as, over time, a policy may be upgraded to include bug fixes or new features.
</div>
<div class="paragraph">
<p>The best way to illustrate how to upgrade a policy plugin is to follow the process step-by-step.
</div>
<div class="paragraph">
<p>For this illustration, we&#8217;ll use one of the policy plugins provided in the official apiman plugins git repository ( <a href="https://github.com/apiman/apiman-plugins" class="bare">https://github.com/apiman/apiman-plugins</a> ) as our custom plugin. Many of the plugins provided in this repository are also available set of "available plugins" packaged with apiman. We&#8217;ll use one of the plugins ("test-policy" - it&#8217;s a very simple policy that adds a header to the inbound http request) that is not already installed into apiman for this example.
</div>
<div class="paragraph">
<p>(Note that in order to follow this example, you will have to have maven and git installed.)
</div>
<div class="paragraph">
<p>To download the policy plugins, execute these commands:
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">git clone https://github.com/apiman/apiman-plugins.git
cd apiman-plugins</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we build the plugins, we have to make one small change. The plugins as downloaded are assigned version numbers that include a -"SNAPSHOT" suffix. We will want to remove that suffix for this example. (Sneak peek: We will restore the suffix later in this article as apiman includes a new feature where "SNAPSHOT" version plugins are automatically reloaded.)
</div>
<div class="paragraph">
<p>To make these changes, edit these files, and change the version from "1.2.2-SNAPSHOT" to "1.2.2":
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./pom.xml
test-policy/pom.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, to build the plugins, and install them into your local maven repo (at runtime, the apiman API Gateway installs plugins from the local maven ".m2" repo directory), execute this command:
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>OK, our policy plugin is built, let&#8217;s add it into the management UI.
</div>
<div class="paragraph">
<p>As an administrative user, navigate to the "Manage Plugins" page in the Management UI and select the "Available Plugins" tab, and then, click on the "Add Custom Plugin" button. The following dialog is displayed:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_5.png" alt="Image: Add Custom Plugin">
</div>
</div>
<div class="paragraph">
<p>Fill in the details for the "test-policy" plugin. (You can find all this information in the plugin&#8217;s "pom.xml" file.) apiman will use this information to locate the policy plugin in your local maven repo:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_6.png" alt="Image: Add Custom Plugin Details">
</div>
</div>
<div class="paragraph">
<p>And, after you click on the "Add Plugin" button, the policy plugin is installed:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_7.png" alt="Image: Custom Plugin Added">
</div>
</div>
<div class="paragraph">
<p>Notice that there are (2) buttons in the "Actions" column of the "Installed Plugins" table. The button labeled with an "X" enables you to remove the plugin. The button labeled with an up-arrow enables you to upgrade the policy plugin.
</div>
<div class="paragraph">
<p>In order for apiman to recognize that a plugin policy has been updated, the plugin version number must change. To change the version number of the test-policy plugin, edit these files, and change the version from "1.2.2" to "1.2.3":
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./pom.xml
test-policy/pom.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, to rebuild the plugins, and install them into your local maven repo, execute this command:
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>After rebuilding the plugins, return to the apiman Management UI, and click on the plugin policy&#8217;s upgrade button. Enter the new plugin version number in the dialog that is displayed:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_8.png" alt="Image: Set the Updated Version Number">
</div>
</div>
<div class="paragraph">
<p>And, after you perform the upgrade by clicking on the "OK" button, the plugin is upgraded:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_9.png" alt="Image: View the Updated Version Number">
</div>
</div>
<div class="paragraph">
<p>There are a few important things to keep in mind while upgrading policy plugins:
</div>
<div class="ulist">
<ul>
<li>
<p>The upgraded version of a policy plugin replaces the previous version.
<li>
<p>Plans, APIs, or Client Apps that had previously been configured with the old version of the plugin policy will continue to use that older version. They will not be automatically updated to use the upgraded version of the policy plugin.
<li>
<p>New Plans, APIs, or Client Apps that are created after the policy plugin was upgraded will use the new/upgraded version.
<li>
<p>If you want to upgrade existing Plans, APIs, or Client Apps to use an upgraded policy plugin, then you will have to manually remove the old policy plugin version and then add the new policy plugin version. The apiman project documentation recommends against doing this unless there is a bug fix or new feature added in a policy plugin upgrade.
</ul>
</div>
<div class="sect2">
<h3 id="automatically-reloading-snapshot-version-policies"><a class="anchor" href="#automatically-reloading-snapshot-version-policies"></a>Automatically Reloading SNAPSHOT Version Policies</h3>
<div class="paragraph">
<p>The final new feature added to Plugin Management in apiman 1.2.x is the automatic reloading of SNAPSHOT version policy plugins.
</div>
<div class="paragraph">
<p>When you are developing a custom policy plugin, you may have to uninstall and reinstall the plugin many times while it is being debugged. This can quickly become a time-consuming manual task. Apiman 1.2.x now makes it possible for you avoid this manual installing/re-installing.
</div>
<div class="paragraph">
<p>As we&#8217;ve just seen, the apiman API Gateway installs policy plugins from your local maven repo. To be more efficient, the API Gateway caches plugins the first time that they are used. If, however, a plugin&#8217;s version ends with a "-SNAPSHOT" suffix, then the API Gateway will reload it every time the plugin is used.
</div>
<div class="paragraph">
<p>So, by including a "-SNAPSHOT" suffix in your custom policy plugin&#8217;s version, you can iterate through changes to the policy plugin without having to manually uninstall and then install each new version of the plugin.
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at this in action.
</div>
<div class="paragraph">
<p>Since we want to take advantage of the automatic reloading, we must restore the "-SNAPSHOT" suffix to the test-policy custom policy plugin. To make these changes, edit these files, and change the version from "1.2.3" to "1.2.2-SNAPSHOT":
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">./pom.xml
test-policy/pom.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, to build the plugins, and install them into your local maven repo, execute this command:
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then add the custom policy plugin in the Management UI:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_10.png" alt="Image: Add SNAPSHOT Plugin">
</div>
</div>
<div class="paragraph">
<p>And, here&#8217;s the installed plugin:
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/blog/2016-02-22/plugin_mgmt_11.png" alt="Image: View SNAPSHOT Plugin">
</div>
</div>
<div class="paragraph">
<p>Before we can configure the custom policy plugin, we need an API. For this example, we&#8217;ll use our old friend, "apiman-echo." You can download this API from this git repository: <a href="https://github.com/apiman/apiman-quickstarts" class="bare">https://github.com/apiman/apiman-quickstarts</a>
</div>
<div class="paragraph">
<p>The steps to build, deploy, and configure this API are available in the first article in this series: <a href="https://www.apiman.io/blog/introduction/overview/2015/01/09/impatient-new-user-redux.html">The Impatient New User Guide to apiman</a>
</div>
<div class="paragraph">
<p>We&#8217;ll use the postman web client to access the API. The first time that we access the API, we&#8217;ll see this response (note the text highlighted in green):
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
 "method" : "GET",
 "resource" : "/apiman-echo",
 "uri" : "/apiman-echo",
 "headers" : {
   "Accept" : "*/*",
   "Cache-Control" : "no-cache",
   "User-Agent" : "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36",
   "Connection" : "keep-alive",
   "Test-Policy" : "true",
   "Postman-Token" : "8808bb68-1c1c-ef97-449d-ab60f620b0e5",
   "Host" : "localhost:8080",
   "Accept-Language" : "en-US,en;q=0.8",
   "Accept-Encoding" : "gzip, deflate, sdch"
 },
 "bodyLength" : null,
 "bodySha1" : null
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>OK, now, let&#8217;s change the policy plugin. In this file: src/main/java/io/apiman/plugins/test_policy/TestPolicy.java
</div>
<div class="paragraph">
<p>Change this line from this: request.getHeaders().put("Test-Policy", "true");
</div>
<div class="paragraph">
<p>To this: request.getHeaders().put("Test-Policy", "quite true");
</div>
<div class="paragraph">
<p>And then, rebuild the plugin with this command:
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn clean install -DskipTests</code></pre>
</div>
</div>
<div class="paragraph">
<p>(The "skipTests" directive is a bit of laziness. There is a test included in the plugin that will fail because of the change that we just made. You can either run this command as is, or you can edit the test in the plugin to also look for a string of "quite true.")
</div>
<div class="paragraph">
<p>Now, when we access the API again, we&#8217;ll see the change reflected - without our having to manually upgrade or uninstall/install the policy plugin:
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
 "method" : "GET",
 "resource" : "/apiman-echo",
 "uri" : "/apiman-echo",
 "headers" : {
   "Accept" : "*/*",
   "Cache-Control" : "no-cache",
   "User-Agent" : "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36",
   "Connection" : "keep-alive",
   "Test-Policy" : "quite true",
   "Postman-Token" : "bb900e07-249c-66e4-980a-2c9a70002c45",
   "Host" : "localhost:8080",
   "Accept-Language" : "en-US,en;q=0.8",
   "Accept-Encoding" : "gzip, deflate, sdch"
 },
 "bodyLength" : null,
 "bodySha1" : null
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="in-conclusion"><a class="anchor" href="#in-conclusion"></a>In Conclusion</h3>
<div class="paragraph">
<p>From its first releases, apiman has provided users with flexibility, including support for adding custom policies through plugins. In the latest release, apiman has expanded on that flexibility by enabling users to uninstall policy plugins, upgrade policy plugins, and automatically reload policy plugins.
</div>
</div>
<div class="sect2">
<h3 id="references"><a class="anchor" href="#references"></a>References</h3>
<div class="ulist">
<ul>
<li>
<p>You can see a more detailed walk-through on how a custom policy plugin is created in this apiman blog post: <a href="https://www.apiman.io/blog/plugins/policies/development/maven/2015/03/06/custom-policies-redux.html" class="bare">https://www.apiman.io/blog/plugins/policies/development/maven/2015/03/06/custom-policies-redux.html</a>
<li>
<p>The "postman" client is available here: <a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en" class="bare">https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en</a>
</ul>
</div>
<div class="paragraph">
<p>/post
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
</div>
</div>
<footer id="apiman-footer" class="p-2 mt-2 mx-auto mw-1350">
<p>
Apiman code is open source and licensed under the <a class="link-dark" href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener">Apache License, v2.0</a>.
<p>The Apiman project was started by Red Hat, although they are no longer directly involved in the project. The project is actively maintained by the community.
<p>Copyright © 2022 Apiman Community & <a class="link-dark" href="https://www.redhat.com/en/about/terms-use" target="_blank" rel="noopener">Red Hat</a>.
<p>
Website was created with 🖤 by Marc Savy of <a class="footer-href" href="https://www.blackparrotlabs.io" target="_blank" rel="noopener">Black Parrot Labs</a> using <a class="footer-href" href="https://www.jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> and <a class="footer-href" href="https://www.getbootstrap.com" target="_blank" rel="noopener">Bootstrap</a>,
and contributed to the Apiman community under the <a class="link-dark" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-SA 4.0</a> license.
</footer>
</div>
<script>window.onload=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.async=!0,e.src="/sw-register.js?v="+Date.now(),t.parentNode.insertBefore(e,t)}</script>
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-TRD82LC9Y2")</script>
</body>
</html>